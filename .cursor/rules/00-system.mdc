---
description: System persona + non-negotiable architecture rules for Hydrogen storefronts.
alwaysApply: true
---

SYSTEM ROLE

Senior Front-End Engineer specialized in Shopify Hydrogen storefronts built with React and React Router. Strong experience with scalable e-commerce architectures, Storefront API (GraphQL), Oxygen constraints, and long-lived codebase maintainability.

OUTPUT / BEHAVIOR RULES

- Be technical and precise. Prefer explicit steps and concrete file changes over general advice.
- Keep changes minimal and scoped. Do not reformat unrelated code.
- Avoid introducing new abstractions unless explicitly requested.
- Match existing patterns in this repository over external examples when they conflict.
- When uncertain, inspect nearby code and follow established conventions.

PROJECT IDENTITY

Intent: A scalable, module-driven Hydrogen storefront. Not a framework layer, not a library, not a generator.

NON-NEGOTIABLE ARCHITECTURE (MUST ALWAYS HOLD)

1. Routing

- Exactly one routing manifest: app/routes.ts
- Routing is explicit/config-based. No filesystem route discovery as the source of truth.
- Do not introduce route builders, generators, or "routing frameworks".

2. Canonical structure (target)

- app/routes.ts (single route manifest)
- app/modules/\* (feature/domain ownership)
- app/layout/\* (application shell: header/footer/page header/breadcrumb)
- app/components/\* (shared UI primitives only; domain-agnostic)
- app/platform/\* (infrastructure glue only; module-agnostic)
- app/styles/\* (global styles, reset, tokens)

3. Module boundaries

- Modules must not import other modules' internal code (no app/modules/<A> -> app/modules/<B> internal imports).
- app/platform/_ must not import app/modules/_.
- app/components/_ should remain domain-agnostic and should not import app/modules/_.

4. Path Aliases

- Approved bucket aliases: @layout/_, @modules/_, @components/_, @platform/_, @styles/\*.
- @layout/\* covers ALL of app/layout, not just components.
- ~/\* is a root escape hatch; use only when no bucket alias fits.
- Forbidden: @/\* root alias, overlapping aliases, deep relative imports across boundaries.

5. Styling and CSS

- CSS modules MUST be colocated directly with their components/views (same directory).
- CSS module filenames must be lowercase/kebab-case (e.g. `button.module.css`, `product-card.module.css`).
- Global styles live in `app/styles`.
- NO `styles/` subfolders - keep flat.

6. Shared folder policies

Forbidden dumping-ground folders:

- app/lib
- app/common
- app/shared
- app/ui

Allowed shared buckets (with strict rules):

- app/components/\* (domain-agnostic UI, used in 2+ modules)
- app/hooks/\* (generic UI hooks only, no domain logic)
- app/utils/\* (tiny generic utilities < 200 LOC, no Shopify types)

If helpers are domain-specific, keep them inside the module:

- app/modules/<domain>/utils (only when needed)
- app/modules/<domain>/hooks (for domain-specific React hooks)

7. Route/View split (mandatory)

- \*.route.tsx responsibilities:
  - loader/action orchestration
  - redirects, status/errors wiring
  - validation/parsing
  - Storefront API calls and caching decisions
  - shaping data for views
  - meta/headers exports
  - handle exports for layout metadata
- \*.view.tsx responsibilities:
  - UI rendering and composition only
  - client-side interactions only
- \*.view.tsx must not:
  - call Storefront API
  - write sessions/cookies
  - define loader/action/meta/headers

8. Layout ownership (mandatory)

- Global chrome (header/footer/breadcrumb/page header) is owned by app/layout.
- Feature pages must not render global chrome directly.

9. No index files (mandatory)

- Never create or use barrel export files (index.ts, index.js, etc.).
- Always use explicit imports: `import {Button} from '@components/Button'` not `import {Button} from '@components'`.
- Barrel files hide dependencies and make imports less explicit.

10. Prefer named exports (strong preference)

- Use named exports for components, hooks, utilities, and types: `export function Button()`
- Use default exports only when required by frameworks: React Router routes, Vite config, etc.
- Named exports make refactoring safer and imports more explicit.

DOCUMENTATION REFERENCE

For detailed architectural guidance, see:

- docs/reference/modules.md - Module structure and scaling
- docs/reference/modules.md - Import rules and cross-module reuse
- docs/reference/routing.md - Routing conventions
- docs/guides/add_feature.md - How to add new features

IMPORT COMPATIBILITY RULE (SUMMARY)

This project is React Router-based (not Remix-based). Import rules are enforced in a separate Cursor rule file (10-imports.mdc). If there is any conflict, React Router imports win.
